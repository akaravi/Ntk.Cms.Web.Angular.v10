@if (requestLinkUserId > 0) {
  <app-core-user-header [optionId]="requestLinkUserId"></app-core-user-header>
}
@if (requestLinkBillboardId?.length > 0) {
  <app-estate-billboard-header [optionId]="requestLinkBillboardId">
  </app-estate-billboard-header>
}
@if (requestLinkContractTypeId?.length > 0) {
  <app-estate-contract-type-header [optionId]="requestLinkContractTypeId">
  </app-estate-contract-type-header>
}
@if (requestLinkCustomerOrderId?.length > 0) {
  <app-estate-customer-order-header [optionId]="requestLinkCustomerOrderId">
  </app-estate-customer-order-header>
}
@if (requestLinkPropertyTypeLanduseId?.length > 0) {
  <app-estate-property-type-landuse-header
    [optionId]="requestLinkPropertyTypeLanduseId"
  >
  </app-estate-property-type-landuse-header>
}
@if (requestLinkPropertyTypeUsageId?.length > 0) {
  <app-estate-property-type-usage-header
    [optionId]="requestLinkPropertyTypeUsageId"
  >
  </app-estate-property-type-usage-header>
}

@if (requestLinkProjectId?.length > 0) {
  <app-estate-property-project-header [optionId]="requestLinkProjectId">
  </app-estate-property-project-header>
}

@if (requestLinkCompanyId?.length > 0) {
  <app-estate-property-company-header [optionId]="requestLinkCompanyId">
  </app-estate-property-company-header>
}

<app-cms-html-list-mobile
  [optionsListInfoAreaId]="constructorInfoAreaId"
  [optionGuideNoticeKey]="'estate.property.list'"
  [(optionActionGuideNoticeDisplay)]="viewGuideNotice"
  (optionOnActionButtonMemoRow)="onActionButtonMemoRow()"
  (optionOnActionButtonMemo)="onActionButtonMemo()"
  (optionOnActionButtonExport)="onActionButtonExport()"
  (optionOnActionButtonPrintRow)="onActionButtonPrintRow()"
  [optionTreeDisplay]="requestLinkPropertyTypeLanduseId?.length === 0"
  [optionActionRowId]="tableRowSelected?.id"
  [optionActionRowDisplay]="tableRowSelected?.id?.length > 0 || requestLinkPropertyTypeLanduseId?.length > 0"
  [optionActionRowDisplayMenu]="tableRowSelect2Click"
  [optionActionRowDisplayMenuAct]="tableRowSelectActionMenuClick"
  [optionSelectRowItemTitle]="tableRowSelected?.title"
  >
  <ng-container cms-tree>
    <!--begin:::::::::::::::::::::::::::::::::::::::::cms-tree-->
    <app-estate-property-type-landuse-tree
      (optionChange)="onActionSelectorSelect($event)"
      >
    </app-estate-property-type-landuse-tree>
    <!--end:::::::::::::::::::::::::::::::::::::::::cms-tree-->
  </ng-container>
  <ng-container cms-header>
    <!--begin:::::::::::::::::::::::::::::::::::::::::cms-header-->
    <!--end:::::::::::::::::::::::::::::::::::::::::cms-header-->
  </ng-container>
  <ng-container cms-action-header>
    <!--begin:::::::::::::::::::::::::::::::::::::::::cms-action-header-->
    <!--end:::::::::::::::::::::::::::::::::::::::::cms-action-header-->
  </ng-container>
  <ng-container cms-action-header-start>
    <!--begin:::::::::::::::::::::::::::::::::::::::::cms-action-header-start-->
    @if (requestLinkPropertyTypeLanduseId?.length > 0) {
      <a
        type="button"
        class="btn font-13 font-600 btn-s m-1 rounded-s shadow-xl border-0 gradient-gray"
        (click)="onActionBackToParent()"
        target="_blank"
        >
        <i class="fa-solid fa-arrow-left font-18" style="color: #ffffff"></i>
      </a>
    }
    <a
      type="button"
      class="btn font-13 font-600 btn-s m-1 rounded-s shadow-xl border-0 gradient-highlight"
      (click)="viewGuideNotice = !viewGuideNotice"
      target="_blank"
      >
      <i class="fa-solid fa-info font-18" style="color: #ffffff"></i>
    </a>
    <a
      type="button"
      class="btn font-13 font-600 btn-s m-1 rounded-s shadow-xl border-0 gradient-highlight"
      (click)="onActionButtonReload()"
      target="_blank"
      >
      <i
        class="fa-solid fa-rotate-right font-18"
        style="color: #ffffff"
        [class.rotation360]="
          publicHelper.processService.process.inRunArea[constructorInfoAreaId]
        "
      ></i>
    </a>
    <a
      (click)="onActionGridExpandRows(true)"
      target="_blank"
      class="btn font-13 font-600 btn-s m-1 rounded-s shadow-xl border-0 gradient-highlight"
      >
      <i class="fa-solid fa-maximize font-18" style="color: #ffffff"></i>
    </a>
    <a
      (click)="onActionGridExpandRows(false)"
      target="_blank"
      class="btn font-13 font-600 btn-s m-1 rounded-s shadow-xl border-0 gradient-highlight"
      >
      <i class="fa-solid fa-minimize font-18" style="color: #ffffff"></i>
    </a>
    <!--end:::::::::::::::::::::::::::::::::::::::::cms-action-header-start-->
  </ng-container>
  <ng-container cms-action-header-end>
    <!--begin:::::::::::::::::::::::::::::::::::::::::cms-action-header-end-->
    <a
      (click)="optionsSearch.data.show = !optionsSearch.data.show"
      class="btn font-13 font-600 btn-s m-1 rounded-s shadow-xl border-0 gradient-highlight"
      >
      <mat-slide-toggle [checked]="optionsSearch.data.show"></mat-slide-toggle
        >{{ "ACTION.SEARCH" | translate }}
      </a>
      <a
        (click)="onActionButtonStatist()"
        class="btn font-13 font-600 btn-s m-1 rounded-s shadow-xl border-0 gradient-highlight"
        >
        <mat-slide-toggle [checked]="optionsStatist.data.show"> </mat-slide-toggle
          >{{ "ACTION.STATIST" | translate }}
        </a>
        <a
          (click)="onActionButtonInChecking(!searchInCheckingChecked)"
          class="btn font-13 font-600 btn-s m-1 rounded-s shadow-xl border-0 gradient-highlight"
          >
          <mat-slide-toggle [checked]="searchInCheckingChecked"> </mat-slide-toggle>
          {{ "ACTION.INCHECKING" | translate }}
        </a>
        <a
          (click)="onActionButtonInResponsible(!searchInResponsibleChecked)"
          class="btn font-13 font-600 btn-s m-1 rounded-s shadow-xl border-0 gradient-highlight"
          >
          <mat-slide-toggle [checked]="searchInResponsibleChecked">
          </mat-slide-toggle>
          {{ "ACTION.InResponsible" | translate }}
        </a>
        <!--end:::::::::::::::::::::::::::::::::::::::::cms-action-header-end-->
      </ng-container>
      <ng-container cms-action-main>
        <!--begin:::::::::::::::::::::::::::::::::::::::::cms-action-->
        @if (dataModelResult?.access?.accessAddRow && optionloadByRoute) {
          <div class="col-4">
            <a
              (click)="onActionButtonNewRow($event)"
              type="button"
              class="btn font-13 font-600 btn-s m-1 rounded-s shadow-xl border-0 gradient-teal"
              target="_blank"
              ><i class="fa-solid fa-plus font-18" style="color: #ffffff"></i> <br
            /></a>
            <p class="font-11 text-center opacity-70">
              {{ "ACTION.ADD" | translate }}
            </p>
          </div>
        }
        @if (dataModelResult?.access?.accessAddRow && optionloadByRoute) {
          <div class="col-4">
            <a
              (click)="onActionButtonQuickAddRow($event)"
              type="button"
              class="btn font-13 font-600 btn-s m-1 rounded-s shadow-xl border-0 gradient-highlight"
              target="_blank"
              id="openModalButton"
              data-toggle="modal"
              data-target="#categoryModal"
              ><i class="fa-solid fa-plus font-18" style="color: #ffffff"></i> <br
            /></a>
            <p class="font-11 text-center opacity-70">
              {{ "ACTION.QUICK_ADD" | translate }}
            </p>
          </div>
        }
        <!--end:::::::::::::::::::::::::::::::::::::::::cms-action-->
      </ng-container>
      <ng-container cms-action-row>
        <!--begin:::::::::::::::::::::::::::::::::::::::::cms-action-row-->
        <div class="col-4">
          <a
            (click)="onActionButtonQuickViewRow(tableRowSelected)"
            type="button"
            class="btn font-13 font-600 btn-s m-1 rounded-s shadow-xl border-0 gradient-highlight"
            target="_blank"
            ><i class="fa-solid fa-eye font-18" style="color: #ffffff"></i><br
          /></a>
          <p class="font-11 text-center opacity-70">
            {{ "ACTION.QUICK_VIEW" | translate }}
          </p>
        </div>
        @if (
          dataModelResult?.access?.accessEditRow &&
          (tableRowSelected?.id?.length > 0 ||
            requestLinkPropertyTypeLanduseId?.length > 0)
        ) {
          <div class="col-4">
            <a
              (click)="onActionButtonEditRow(tableRowSelected, $event)"
              type="button"
              class="btn font-13 font-600 btn-s m-1 rounded-s shadow-xl border-0 gradient-magenta"
              target="_blank"
              ><i class="fa-solid fa-pen font-18" style="color: #ffffff"></i><br
            /></a>
            <p class="font-11 text-center opacity-70">
              {{ "ACTION.EDIT" | translate }}
            </p>
          </div>
        }
        @if (
          dataModelResult?.access?.accessDeleteRow &&
          optionloadByRoute &&
          (tableRowSelected?.id?.length > 0 ||
            requestLinkPropertyTypeLanduseId?.length > 0)
        ) {
          <div class="col-4">
            <a
              (click)="onActionButtonDeleteRow(tableRowSelected)"
              type="button"
              class="btn font-13 font-600 btn-s m-1 rounded-s shadow-xl border-0 gradient-red"
              target="_blank"
              ><i class="fa-solid fa-trash font-18" style="color: #ffffff"></i><br
            /></a>
            <p class="font-11 text-center opacity-70">
              {{ "ACTION.DELETE" | translate }}
            </p>
          </div>
        }
        @if (
          tokenHelper.isAdminSite &&
          optionloadByRoute &&
          tableRowSelected?.id?.length > 0
        ) {
          <div class="col-4">
            <a
              (click)="onActionButtonActionSendSmsToCustomerOrder()"
              type="button"
              class="btn font-13 font-600 btn-s m-1 rounded-s shadow-xl border-0 gradient-highlight"
              target="_blank"
              ><i
                class="fa-light fa-message-lines font-18"
                style="color: #ffffff"
              ></i
              ><br />
            </a>
            <p class="font-11 text-center opacity-70">
              {{ "ACTION.ActionSendSmsToCustomerOrder" | translate }}
            </p>
          </div>
        }
        @if (dataModelResult?.access?.accessEditRow) {
          <div class="col-4">
            <a
              (click)="onActionButtonAdsRow(tableRowSelected, $event)"
              type="button"
              class="btn font-13 font-600 btn-s m-1 rounded-s shadow-xl border-0 gradient-highlight"
              target="_blank"
              ><i
                class="fa-solid fa-bullseye-pointer font-18"
                style="color: #ffffff"
              ></i
              ><br />
            </a>
            <p class="font-11 text-center opacity-70">
              {{ "ACTION.ADS" | translate }}
            </p>
          </div>
        }
        <div class="col-4">
          <a
            (click)="onActionButtonQuickHistoryAddRow(tableRowSelected)"
            type="button"
            class="btn font-13 font-600 btn-s m-1 rounded-s shadow-xl border-0 gradient-highlight"
            target="_blank"
            ><i
              class="fa-solid fa-clock-rotate-left font-18"
              style="color: #ffffff"
            ></i
            ><br />
          </a>
          <p class="font-11 text-center opacity-70">
            {{ "ACTION.HISTORY_ADD" | translate }}
          </p>
        </div>
        <div class="col-4">
          <a
            (click)="onActionButtonHistoryRow(tableRowSelected, $event)"
            type="button"
            class="btn font-13 font-600 btn-s m-1 rounded-s shadow-xl border-0 gradient-highlight"
            target="_blank"
            ><i
              class="fa-solid fa-clock-rotate-left font-18"
              style="color: #ffffff"
            ></i
            ><br />
          </a>
          <p class="font-11 text-center opacity-70">
            {{ "ACTION.HISTORY_LIST" | translate }}
          </p>
        </div>
        <div class="col-4">
          <a
            (click)="onActionButtonViewOtherUserAdvertise(tableRowSelected)"
            type="button"
            class="btn font-13 font-600 btn-s m-1 rounded-s shadow-xl border-0 gradient-highlight"
            target="_blank"
            ><i class="fa-solid fa-user font-18" style="color: #ffffff"></i><br
          /></a>
          <p class="font-11 text-center opacity-70">
            {{ "ACTION.VIEW_OTHER_USER_ADVERTISE" | translate }}
          </p>
        </div>
        <div class="col-4">
          <a
            routerLink="{{ '/core/user/edit/' + tableRowSelected?.createdBy }}"
            type="button"
            class="btn font-13 font-600 btn-s m-1 rounded-s shadow-xl border-0 gradient-highlight"
            target="_blank"
            ><i class="fa-solid fa-user font-18" style="color: #ffffff"></i><br
          /></a>
          <p class="font-11 text-center opacity-70">
            {{ "ACTION.VIEW_USER" | translate }}
          </p>
        </div>
        <div class="col-4">
          <a
            (click)="onActionButtonLinkTo(tableRowSelected)"
            type="button"
            class="btn font-13 font-600 btn-s m-1 rounded-s shadow-xl border-0 gradient-highlight"
            target="_blank"
            ><i class="fa-solid fa-share font-18" style="color: #ffffff"></i><br
          /></a>
          <p class="font-11 text-center opacity-70">
            {{ "TITLE.LINKTO" | translate }}
          </p>
        </div>
        <div class="col-4">
          <a
            (click)="onActionButtonResponsibleUserlistView(tableRowSelected)"
            type="button"
            class="btn font-13 font-600 btn-s m-1 rounded-s shadow-xl border-0 gradient-highlight"
            target="_blank"
            ><i class="fa-solid fa-share font-18" style="color: #ffffff"></i><br
          /></a>
          <p class="font-11 text-center opacity-70">
            {{ "TITLE.ResponsibleUsers" | translate }}
          </p>
        </div>
        @if (
          tableRowSelected &&
          tokenInfo?.access?.siteId > 0 &&
          tableRowSelected?.linkSiteId !== tokenInfo.access.siteId
        ) {
          <div class="col-4">
            <a
              routerLink="{{ '/core/site/edit/' + tableRowSelected?.linkSiteId }}"
              type="button"
              class="btn font-13 font-600 btn-s m-1 rounded-s shadow-xl border-0 gradient-highlight"
              target="_blank"
              >
              {{ "ACTION.VIEW_SITE" | translate }}
            </a>
          </div>
        }
        <!--end:::::::::::::::::::::::::::::::::::::::::cms-action-row-->
      </ng-container>
      <ng-container cms-action-area>
        <!--begin:::::::::::::::::::::::::::::::::::::::::cms-action-area-->
        <app-cms-search-list [(options)]="optionsSearch">
          <hr />
          <p>{{ "MESSAGE.Content_of_your_choice_to_display" | translate }}</p>
          <!-- caseCode Field -->
          <mat-form-field class="ntk-full-width">
            <mat-label>{{ fieldsInfo["caseCode"]?.fieldTitle }}</mat-label>
            <input
              (input)="onSearchCaseCodeChange($event.target.value)"
              matInput
              [(ngModel)]="filteModelContent.caseCode"
              name="filteModelContent.caseCode"
              #caseCode
              type="text"
              placeholder="{{ fieldsInfo['caseCode']?.fieldTitle }}"
              step="1"
              />
            @if (filteModelContent.caseCode) {
              <mat-icon
                matPrefix
                matPrefix
                mat-icon-button
                aria-label="Clear"
                (click)="filteModelContent.caseCode = ''"
                >
                close</mat-icon
              >
            }
            <mat-icon matPrefix> mode_edit</mat-icon>
            <mat-hint>
              <mat-icon matSuffix class="info-field-icon">{{
                "TITLE.info" | translate
              }}</mat-icon>
              <strong class="info-field-text">{{
                fieldsInfo["caseCode"]?.fieldDescription
              }}</strong>
            </mat-hint>
          </mat-form-field>
          @if (
            !filteModelContent.caseCode || filteModelContent.caseCode.length === 0
          ) {
            <div>
              <P
                >{{
                  "MESSAGE.Selecting_any_of_the_following_will_make_the_search_results_range_smaller"
                    | translate
                }}
              </P>
              <!-- linkResponsibleUserId Field -->
              @if (tokenHelper.isAdminSite) {
                <app-cms-user-selector
                  (optionChange)="
                    filteModelContent.linkResponsibleUserId = $event?.id
                  "
                  [optionPlaceholder]="'TITLE.InResponsibleTo' | translate"
                  >
                </app-cms-user-selector>
              }
              <!-- LinkLocationIds Field -->
              <app-cms-location-autocomplete
                (optionChange)="onActionSelectorLocation($event)"
                [optionPlaceholder]="'TITLE.Region' | translate"
                >
              </app-cms-location-autocomplete>
            </div>
          }
        </app-cms-search-list>

        <app-cms-statist-list [(options)]="optionsStatist"></app-cms-statist-list>
        <!--end:::::::::::::::::::::::::::::::::::::::::cms-action-area-->
      </ng-container>
      <ng-container cms-body>
        <!--begin:::::::::::::::::::::::::::::::::::::::::cms-body-->
        <!-- Mobile List View -->
        @if (dataModelResult?.listItems?.length) {
          <div class="cms-m-list">
            @for (row of dataModelResult.listItems; track row.id) {
              <div class="cms-m-list-item-wrapper">
                <div
                  class="cms-m-list-item"
                  [class.selected]="row.id === tableRowSelected?.id"
                  (click)="onActionTableRowSelect(row, $event)"
                  (rtclick)="onActionTableRowSelect(row, $event)"
                  (mouseenter)="onActionTableRowMouseEnter(row)"
                  (mouseleave)="onActionTableRowMouseLeave(row)"
                  role="button"
                  [attr.aria-label]="row.title || row.id"
                  tabindex="0"
                >
                  @if (row?.linkMainImageIdSrc?.length > 0) {
                    <div class="cms-m-list-item-image">
                      <img
                        [src]="row.linkMainImageIdSrc | cmsthumbnail"
                        [alt]="row.title || row.id"
                        loading="lazy"
                      />
                    </div>
                  } @else {
                    <div class="cms-m-list-item-image-placeholder">
                      <i class="fa-solid fa-house" aria-hidden="true"></i>
                    </div>
                  }
                  <div class="cms-m-list-item-content">
                    <div class="cms-m-list-item-title">
                      {{ row.title || row.id }}
                    </div>
                    @if (row.caseCode) {
                      <div class="cms-m-list-item-subtitle">
                        <i class="fa-solid fa-hashtag" aria-hidden="true"></i>
                        {{ fieldsInfo["caseCode"]?.fieldTitle }}: {{ row.caseCode }}
                      </div>
                    }
                    @if (row.description) {
                      <div class="cms-m-list-item-description">
                        {{ row.description }}
                      </div>
                    }
                    @if (row.area && row.area > 0) {
                      <div class="cms-m-list-item-subtitle">
                        <i class="fa-solid fa-ruler-combined" aria-hidden="true"></i>
                        {{ "TITLE.SquareMeters" | translate }}: {{ row.area }}
                      </div>
                    }
                    @if (row.createdYaer && row.createdYaer > 0) {
                      <div class="cms-m-list-item-subtitle">
                        <i class="fa-solid fa-calendar" aria-hidden="true"></i>
                        {{ "TITLE.CreatedYaer" | translate }}: {{ row.createdYaer }}
                      </div>
                    }
                    @if (row.linkLocationIdParentTitle || row.linkLocationIdTitle) {
                      <div class="cms-m-list-item-subtitle">
                        <i class="fa-solid fa-location-dot" aria-hidden="true"></i>
                        {{ row.linkLocationIdParentTitle }} {{ row.linkLocationIdTitle }}
                      </div>
                    }
                    @if (row.address) {
                      <div class="cms-m-list-item-subtitle">
                        <i class="fa-solid fa-map-marker-alt" aria-hidden="true"></i>
                        {{ row.address }}
                      </div>
                    }
                    @if (row.updatedDate || row.recordStatus) {
                      <div class="cms-m-list-item-footer">
                        @if (row.recordStatus) {
                          <div class="cms-m-list-item-status">
                            <i
                              [ngClass]="row.recordStatus | statusIconClass"
                              aria-hidden="true"
                            ></i>
                          </div>
                        }
                        @if (row.updatedDate) {
                          <div class="cms-m-list-item-date">
                            <i class="fa-solid fa-clock" aria-hidden="true"></i>
                            <span>{{ row.updatedDate | localeDate }}</span>
                          </div>
                        }
                      </div>
                    }
                    <!-- Expanded Detail (when row is expanded) -->
                    @if (getRowExpanded(row)) {
                      <div class="cms-m-list-item-expanded">
                        @if (row?.linkMainImageIdSrc?.length > 0) {
                          <div class="cms-m-list-item-expanded-image">
                            <img
                              [src]="row.linkMainImageIdSrc | cmsthumbnail"
                              [alt]="row.title || row.id"
                              loading="lazy"
                            />
                          </div>
                        }
                        <div class="cms-m-list-item-subtitle">
                          <span
                            class="navi-icon pointer"
                            [cdkCopyToClipboard]="row.id.toString()"
                            (click)="onActionCopied(); $event.stopPropagation()"
                            >
                            <i class="flaticon2-copy"></i>
                          </span>
                          ID: {{ row.id }}
                        </div>
                        @if (row.createdBy) {
                          <div class="cms-m-list-item-subtitle">
                            <i class="fa-solid fa-user" aria-hidden="true"></i>
                            {{ row.createdBy | cmsuserinfo | async }}
                          </div>
                        }
                        @if (row.historyTotalCount) {
                          <div class="cms-m-list-item-subtitle">
                            <i class="fa-solid fa-clock-rotate-left" aria-hidden="true"></i>
                            {{ "TITLE.HISTORY" | translate }}: {{ row.historyTotalCount }}
                          </div>
                        }
                      </div>
                    }
                  </div>
                </div>
              </div>
            }
          </div>
        } @else {
          <div class="cms-m-empty">
            {{ "MESSAGE.NoRecord" | translate }}
          </div>
        }
        <!--end:::::::::::::::::::::::::::::::::::::::::cms-body-->
      </ng-container>
        <ng-container cms-footer>
          <!--begin:::::::::::::::::::::::::::::::::::::::::cms-footer-->
          <mat-paginator
            #paginator
            [length]="dataModelResult.totalRowCount"
            [pageIndex]="dataModelResult.currentPageNumber - 1"
            [pageSize]="dataModelResult.rowPerPage"
            [pageSizeOptions]="[5, 10, 20, 100]"
            (page)="onTablePageingData($event)"
          ></mat-paginator>
          <!--end:::::::::::::::::::::::::::::::::::::::::cms-footer-->
        </ng-container>
      </app-cms-html-list-mobile>
