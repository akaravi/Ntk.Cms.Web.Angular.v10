<div class="cms-m-body loader-container">
  <app-progress-spinner [optionsInfoAreaId]="constructorInfoAreaId">
  </app-progress-spinner>

  <!-- Header با Safe Area برای iPhone -->
  <div class="cms-m-header safe-area-top">
    <div class="cms-m-header-content">
      @if (
        requestLinkApiPathId?.length > 0 || requestLinkApiNumberId?.length > 0
      ) {
        <button
          type="button"
          class="cms-m-back-btn"
          (click)="onActionBackToParent()"
          aria-label="{{ 'ACTION.BACK' | translate }}"
        >
          <i class="fa-solid fa-arrow-right" aria-hidden="true"></i>
        </button>
      }
      <h1 class="cms-m-header-title">
        {{ "ROUTE.SMS.LOG" | translate }}
      </h1>
      <div class="cms-m-header-actions">
        <button
          type="button"
          class="cms-m-header-action-btn"
          (click)="optionsSearch.data.show = !optionsSearch.data.show"
          [class.active]="optionsSearch.data.show"
          [attr.aria-label]="'ACTION.SEARCH' | translate"
        >
          <i class="fa-solid fa-magnifying-glass" aria-hidden="true"></i>
        </button>
        <button
          type="button"
          class="cms-m-header-action-btn"
          (click)="onActionButtonReload()"
          [attr.aria-label]="'ACTION.RELOAD' | translate"
        >
          <i
            class="fa-solid fa-rotate-right"
            [class.rotation360]="
              publicHelper.processService.process.inRunArea[
                constructorInfoAreaId
              ]
            "
            aria-hidden="true"
          ></i>
        </button>
        <button
          type="button"
          class="cms-m-header-action-btn"
          (click)="onActionButtonStatist()"
          [class.active]="optionsStatist?.data?.show"
          [attr.aria-label]="'ACTION.STATIST' | translate"
        >
          <i class="fa-solid fa-chart-bar" aria-hidden="true"></i>
        </button>
      </div>
    </div>
  </div>

  <!-- Search Area -->
  @if (optionsSearch.data.show) {
    <div class="cms-m-search-area safe-area-content">
      <app-cms-search-list [(options)]="optionsSearch"></app-cms-search-list>
    </div>
  }

  <!-- Statist Area -->
  @if (optionsStatist?.data?.show) {
    <div class="cms-m-statist-area safe-area-content">
      <app-cms-statist-list [(options)]="optionsStatist"></app-cms-statist-list>
    </div>
  }

  <!-- Pull-to-Refresh Indicator -->
  @if (pullToRefreshState.pullDistance > 0) {
    <div
      class="cms-m-pull-refresh-indicator"
      [style.transform]="
        'translateY(' +
        (pullToRefreshState.pullDistance > 80
          ? 80
          : pullToRefreshState.pullDistance) +
        'px)'
      "
      [class.refreshing]="pullToRefreshState.isRefreshing"
    >
      <i
        class="fa-solid fa-rotate-right"
        [class.rotation360]="pullToRefreshState.isRefreshing"
        aria-hidden="true"
      ></i>
      <span>{{
        pullToRefreshState.isRefreshing
          ? ("ACTION.RELOADING" | translate)
          : ("ACTION.PULL_TO_REFRESH" | translate)
      }}</span>
    </div>
  }

  <!-- Content Area -->
  <div
    class="cms-m-content safe-area-content"
    (touchstart)="onTouchStart($event)"
    (touchmove)="onTouchMove($event)"
    (touchend)="onTouchEnd($event)"
  >
    @if (dataModelResult?.listItems && dataModelResult.listItems.length > 0) {
      <div class="cms-m-list">
        @for (row of dataModelResult.listItems; track row.id) {
          <div
            class="cms-m-list-item-wrapper"
            [style.transform]="
              'translateX(' + (swipeState.get(row.id)?.offset || 0) + 'px)'
            "
          >
            <div
              class="cms-m-list-item"
              [class.selected]="row.id === tableRowSelected?.id"
              (click)="onActionTableRowSelect(row)"
              (touchstart)="onItemTouchStart($event, row.id)"
              (touchmove)="onItemTouchMove($event, row.id)"
              (touchend)="onItemTouchEnd($event, row.id)"
              role="button"
              [attr.aria-label]="row.id"
              tabindex="0"
            >
              <div class="cms-m-list-item-image-placeholder">
                <i class="fa-solid fa-paper-plane" aria-hidden="true"></i>
              </div>

              <div class="cms-m-list-item-content">
                <div class="cms-m-list-item-title">
                  {{
                    row.linkApiPathId
                      ? (row.linkApiPathId
                        | cmstitle: dataModelPrivateResult.listItems)
                      : ("TITLE.ApiPath" | translate)
                  }}
                </div>

                @if (row.linkApiNumberId) {
                  <div class="cms-m-list-item-subtitle">
                    <i class="fa-solid fa-sim-card" aria-hidden="true"></i>
                    <span
                      >{{ "TITLE.ApiNumber" | translate }}:
                      {{ row.linkApiNumberId }}</span
                    >
                  </div>
                }

                @if (row.message?.length) {
                  <div class="cms-m-list-item-message">
                    <i class="fa-solid fa-comment-dots" aria-hidden="true"></i>
                    <span>{{ row.message }}</span>
                  </div>
                }

                <div class="cms-m-list-item-footer">
                  <div class="cms-m-list-item-status">
                    <i
                      [ngClass]="row.recordStatus | statusIconClass"
                      aria-hidden="true"
                    ></i>
                  </div>
                  <div class="cms-m-list-item-date">
                    <i class="fa-solid fa-hashtag" aria-hidden="true"></i>
                    <span>{{ row.id }}</span>
                  </div>
                </div>

                @if (row.sendDate) {
                  <div class="cms-m-list-item-date">
                    <i class="fa-solid fa-paper-plane" aria-hidden="true"></i>
                    <span
                      >{{ "TITLE.SendDate" | translate }}:
                      {{ row.sendDate | localeDate }}</span
                    >
                  </div>
                }

                @if (row.createdDate) {
                  <div class="cms-m-list-item-date">
                    <i class="fa-solid fa-clock" aria-hidden="true"></i>
                    <span
                      >{{ "TITLE.CreatedDate" | translate }}:
                      {{ row.createdDate | localeDate }}</span
                    >
                  </div>
                }

                @if (row.updatedDate) {
                  <div class="cms-m-list-item-date">
                    <i
                      class="fa-solid fa-clock-rotate-left"
                      aria-hidden="true"
                    ></i>
                    <span
                      >{{ "TITLE.UpdatedDate" | translate }}:
                      {{ row.updatedDate | localeDate }}</span
                    >
                  </div>
                }
              </div>

              <div class="cms-m-list-item-actions">
                @if (dataModelResult?.access?.accessWatchRow) {
                  <button
                    class="cms-m-action-btn view"
                    (click)="
                      onActionButtonViewRow(row); $event.stopPropagation()
                    "
                    [attr.aria-label]="'ACTION.VIEW' | translate"
                  >
                    <i class="fa-solid fa-eye" aria-hidden="true"></i>
                  </button>
                }
                @if (dataModelResult?.access?.accessWatchRow) {
                  <button
                    class="cms-m-action-btn detail"
                    (click)="
                      onActionButtonDetailRow(row); $event.stopPropagation()
                    "
                    [attr.aria-label]="'ACTION.DETAIL' | translate"
                  >
                    <i class="fa-solid fa-list" aria-hidden="true"></i>
                  </button>
                }
                @if (dataModelResult?.access?.accessEditRow) {
                  <button
                    class="cms-m-action-btn edit"
                    (click)="
                      onActionButtonEditRow(row); $event.stopPropagation()
                    "
                    [attr.aria-label]="'ACTION.EDIT' | translate"
                  >
                    <i class="fa-solid fa-pen" aria-hidden="true"></i>
                  </button>
                }
                @if (dataModelResult?.access?.accessDeleteRow) {
                  <button
                    class="cms-m-action-btn delete"
                    (click)="
                      onActionButtonDeleteRow(row); $event.stopPropagation()
                    "
                    [attr.aria-label]="'ACTION.DELETE' | translate"
                  >
                    <i class="fa-solid fa-trash" aria-hidden="true"></i>
                  </button>
                }
              </div>
            </div>

            <!-- Swipe Actions Background -->
            <div class="cms-m-list-item-swipe-actions">
              @if (dataModelResult?.access?.accessDeleteRow) {
                <button
                  class="cms-m-swipe-action-btn delete"
                  (click)="
                    onActionButtonDeleteRow(row); $event.stopPropagation()
                  "
                  [attr.aria-label]="'ACTION.DELETE' | translate"
                >
                  <i class="fa-solid fa-trash" aria-hidden="true"></i>
                </button>
              }
            </div>
          </div>
        }
      </div>
    } @else {
      <div class="cms-m-empty-state">
        <div class="cms-m-empty-state-icon">
          <i class="fa-solid fa-paper-plane" aria-hidden="true"></i>
        </div>
        <div class="cms-m-empty-state-text">
          {{ "MESSAGE.no_information" | translate }}
        </div>
      </div>
    }
  </div>

  <!-- Footer با Safe Area برای iPhone -->
  <div class="cms-m-footer safe-area-bottom">
    @if (dataModelResult?.totalRowCount > 0) {
      <div class="cms-m-pagination-wrapper">
        <mat-paginator
          #paginator
          [length]="dataModelResult?.totalRowCount || 0"
          [pageIndex]="(dataModelResult?.currentPageNumber || 1) - 1"
          [pageSize]="dataModelResult?.rowPerPage || 10"
          [pageSizeOptions]="[5, 10, 20, 100]"
          (page)="onTablePageingData($event)"
        ></mat-paginator>
      </div>
    }
  </div>
</div>
