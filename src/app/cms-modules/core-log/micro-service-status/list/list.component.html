<app-cms-html-list
  [optionsListInfoAreaId]="constructorInfoAreaId"
  [optionGuideNoticeKey]="''"
  [(optionActionGuideNoticeDisplay)]="viewGuideNotice"
  [optionTreeDisplay]="false"
  [optionActionRowId]="tableRowSelected?.id"
  [optionActionRowDisplayMenu]="tableRowSelect2Click"
  [optionSelectRowItemTitle]="tableRowSelected?.appInfo"
>
  <ng-container cms-tree></ng-container>
  <ng-container cms-header></ng-container>
  <ng-container cms-action-header></ng-container>
  <ng-container cms-action-header-start>
    <a
      type="button"
      class="btn font-13 font-600 btn-s m-1 rounded-s shadow-xl border-0 gradient-highlight"
      (click)="viewGuideNotice = !viewGuideNotice"
      target="_blank"
    >
      <i class="fa-solid fa-info font-18" style="color: #ffffff"></i>
    </a>
    <button
      type="button"
      class="btn font-13 font-600 btn-s m-1 rounded-s shadow-xl border-0 gradient-highlight"
      (click)="onActionButtonReload()"
      [disabled]="statusLoading"
    >
      <i
        class="fa-solid fa-rotate-right font-18"
        style="color: #ffffff"
        [class.rotation360]="statusLoading"
      ></i>
    </button>
    <div class="filter-group m-1">
      <input
        type="text"
        [(ngModel)]="appInfoFilter"
        [placeholder]="'ROUTE.CORELOG.MICROSERVICEMONITOR_FILTER' | translate"
        class="form-control"
        style="display: inline-block; width: auto"
      />
      <button
        type="button"
        class="btn btn-primary m-1"
        (click)="onApplyFilter()"
      >
        {{ "ROUTE.CORELOG.MICROSERVICEMONITOR_APPLY" | translate }}
      </button>
    </div>
  </ng-container>
  <ng-container cms-action-header-end></ng-container>
  <ng-container cms-action-main></ng-container>
  <ng-container cms-action-row>
    @if (tableRowSelected) {
      <div class="col-4">
        <button
          type="button"
          class="btn font-13 font-600 btn-s m-1 rounded-s shadow-xl border-0 gradient-highlight"
          (click)="onActionButtonViewRow(tableRowSelected)"
        >
          <i class="fa-solid fa-eye font-18" style="color: #ffffff"></i><br />
        </button>
        <p class="font-11 text-center opacity-70">
          {{ "ACTION.VIEW" | translate }}
        </p>
      </div>
      <div class="col-4">
        <button
          type="button"
          class="btn font-13 font-600 btn-s m-1 rounded-s shadow-xl border-0 gradient-highlight"
          (click)="onPing()"
          [disabled]="pingLoading"
        >
          <i class="fa-solid fa-signal font-18" style="color: #ffffff"></i
          ><br />
        </button>
        <p class="font-11 text-center opacity-70">
          {{
            pingLoading
              ? ("ROUTE.CORELOG.MICROSERVICEMONITOR_PINGING" | translate)
              : "Ping"
          }}
        </p>
      </div>
      <div class="col-4">
        <button
          type="button"
          class="btn font-13 font-600 btn-s m-1 rounded-s shadow-xl border-0 gradient-magenta"
          (click)="onSendCommand(MicroServiceCommandTypeEnum.PauseStatus)"
          [disabled]="commandLoading"
        >
          <i class="fa-solid fa-pause font-18" style="color: #ffffff"></i><br />
        </button>
        <p class="font-11 text-center opacity-70">
          {{ getCommandLabel(MicroServiceCommandTypeEnum.PauseStatus) }}
        </p>
      </div>
      <div class="col-4">
        <button
          type="button"
          class="btn font-13 font-600 btn-s m-1 rounded-s shadow-xl border-0 gradient-blue"
          (click)="onSendCommand(MicroServiceCommandTypeEnum.ResumeStatus)"
          [disabled]="commandLoading"
        >
          <i class="fa-solid fa-play font-18" style="color: #ffffff"></i><br />
        </button>
        <p class="font-11 text-center opacity-70">
          {{ getCommandLabel(MicroServiceCommandTypeEnum.ResumeStatus) }}
        </p>
      </div>
      <div class="col-4">
        <button
          type="button"
          class="btn font-13 font-600 btn-s m-1 rounded-s shadow-xl border-0 gradient-green"
          (click)="onSendCommand(MicroServiceCommandTypeEnum.ReloadConfig)"
          [disabled]="commandLoading"
        >
          <i class="fa-solid fa-rotate font-18" style="color: #ffffff"></i
          ><br />
        </button>
        <p class="font-11 text-center opacity-70">
          {{ getCommandLabel(MicroServiceCommandTypeEnum.ReloadConfig) }}
        </p>
      </div>
      <div class="col-4">
        <button
          type="button"
          class="btn font-13 font-600 btn-s m-1 rounded-s shadow-xl border-0 gradient-yellow"
          (click)="onSendCommand(MicroServiceCommandTypeEnum.UpdateSettings)"
          [disabled]="commandLoading"
        >
          <i class="fa-solid fa-gear font-18" style="color: #ffffff"></i><br />
        </button>
        <p class="font-11 text-center opacity-70">
          {{ getCommandLabel(MicroServiceCommandTypeEnum.UpdateSettings) }}
        </p>
      </div>
      @if (pingResult) {
        <div class="col-12">
          <div class="ping-result p-2 bg-success text-white rounded">
            <strong>RTT: {{ pingResult.rttMs ?? "-" }} ms</strong>
          </div>
        </div>
      }
      @if (errorMessage) {
        <div class="col-12">
          <div class="alert alert-danger">{{ errorMessage }}</div>
        </div>
      }
    }
  </ng-container>
  <ng-container cms-action-area></ng-container>
  <ng-container cms-body>
    @if (errorMessage && !statusList?.length) {
      <div class="alert alert-error">{{ errorMessage }}</div>
    }
    @if (statusLoading) {
      <div class="text-center p-4">
        <i class="fa-solid fa-spinner fa-spin font-24"></i>
        <p>{{ "ACTION.LOADING" | translate }}</p>
      </div>
    } @else if (statusList?.length) {
      <mat-table
        [dataSource]="tableSource"
        matSort
        #tableSort="matSort"
        (matSortChange)="onTableSortData(tableSort)"
      >
        <!-- App Info Column -->
        <ng-container matColumnDef="appInfo">
          <mat-header-cell *matHeaderCellDef mat-sort-header>
            {{ "ROUTE.CORELOG.MICROSERVICEMONITOR_APPINFO" | translate }}
          </mat-header-cell>
          <mat-cell *matCellDef="let row">{{ row.appInfo || "-" }}</mat-cell>
        </ng-container>

        <!-- Instance Identifier Column -->
        <ng-container matColumnDef="instanceIdentifier">
          <mat-header-cell *matHeaderCellDef mat-sort-header>
            Instance Identifier
          </mat-header-cell>
          <mat-cell *matCellDef="let row">
            <span class="badge badge-info">{{
              row.instanceIdentifier || "-"
            }}</span>
          </mat-cell>
        </ng-container>

        <!-- Runtime Identity Column -->
        <ng-container matColumnDef="runtimeIdentity">
          <mat-header-cell *matHeaderCellDef mat-sort-header>
            Runtime Identity
          </mat-header-cell>
          <mat-cell *matCellDef="let row">
            <span class="badge badge-secondary">{{
              row.runtimeIdentity || "-"
            }}</span>
          </mat-cell>
        </ng-container>

        <!-- RabbitMQ UserName Column -->
        <ng-container matColumnDef="rabbitMQUserName">
          <mat-header-cell *matHeaderCellDef mat-sort-header>
            RabbitMQ UserName
          </mat-header-cell>
          <mat-cell *matCellDef="let row">
            {{ row.rabbitMQUserName || "-" }}
          </mat-cell>
        </ng-container>

        <!-- Active Queues Column -->
        <ng-container matColumnDef="activeQueues">
          <mat-header-cell *matHeaderCellDef> Queueهای فعال </mat-header-cell>
          <mat-cell *matCellDef="let row">
            <span *ngIf="row.activeQueues && row.activeQueues.length > 0">
              <span
                *ngFor="let queue of row.activeQueues; let last = last"
                class="badge badge-success mr-1"
              >
                {{ queue }}<span *ngIf="!last">, </span>
              </span>
            </span>
            <span
              *ngIf="!row.activeQueues || row.activeQueues.length === 0"
              class="text-muted"
            >
              -
            </span>
          </mat-cell>
        </ng-container>

        <!-- App Version Column -->
        <ng-container matColumnDef="appVersion">
          <mat-header-cell *matHeaderCellDef mat-sort-header>
            {{ "ROUTE.CORELOG.MICROSERVICEMONITOR_VERSION" | translate }}
          </mat-header-cell>
          <mat-cell *matCellDef="let row"
            >v{{ row.appVersion || "-" }}</mat-cell
          >
        </ng-container>

        <!-- Status Column -->
        <ng-container matColumnDef="status">
          <mat-header-cell *matHeaderCellDef>
            {{ "ROUTE.CORELOG.MICROSERVICEMONITOR_STATUS" | translate }}
          </mat-header-cell>
          <mat-cell *matCellDef="let row">
            <span class="status-badge">
              <span class="dot" [class.online]="isOnline(row)"></span>
              {{
                isOnline(row)
                  ? ("ROUTE.CORELOG.MICROSERVICEMONITOR_ONLINE" | translate)
                  : ("ROUTE.CORELOG.MICROSERVICEMONITOR_OFFLINE" | translate)
              }}
            </span>
          </mat-cell>
        </ng-container>

        <!-- Last Update Column -->
        <ng-container matColumnDef="lastUpdate">
          <mat-header-cell *matHeaderCellDef mat-sort-header>
            {{ "ROUTE.CORELOG.MICROSERVICEMONITOR_LASTUPDATE" | translate }}
          </mat-header-cell>
          <mat-cell *matCellDef="let row">{{ getLastUpdate(row) }}</mat-cell>
        </ng-container>

        <!-- Action Column -->
        <ng-container matColumnDef="Action">
          <mat-header-cell *matHeaderCellDef>
            {{ "TITLE.OPTION" | translate }}
          </mat-header-cell>
          <mat-cell *matCellDef="let row" class="Action">
            <button
              type="button"
              mat-icon-button
              (click)="onActionView(row)"
              matTooltip="{{ 'ACTION.VIEW' | translate }}"
            >
              <mat-icon>visibility</mat-icon>
            </button>
            <button
              type="button"
              mat-icon-button
              color="primary"
              (click)="onActionPing(row)"
              [disabled]="pingLoading"
              matTooltip="Ping"
            >
              <mat-icon>send</mat-icon>
            </button>
          </mat-cell>
        </ng-container>

        <mat-header-row
          *matHeaderRowDef="tabledisplayedColumns"
        ></mat-header-row>
        <mat-row
          *matRowDef="
            let row;
            columns: tabledisplayedColumns;
            let i = dataIndex
          "
          class="ntk-row-mainfild"
          (click)="onActionTableRowSelect(row, $event)"
          (rtclick)="onActionTableRowSelect(row, $event)"
          [class.ntk-row-selected]="row.id === tableRowSelected?.id"
        >
        </mat-row>
      </mat-table>
    } @else if (!statusLoading) {
      <div class="cms-m-empty">
        {{ "ROUTE.CORELOG.MICROSERVICEMONITOR_EMPTY" | translate }}
      </div>
    }
  </ng-container>
  <ng-container cms-footer></ng-container>
</app-cms-html-list>
