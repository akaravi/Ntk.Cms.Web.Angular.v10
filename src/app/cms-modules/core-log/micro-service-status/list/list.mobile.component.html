<app-cms-html-list-mobile
  [optionsListInfoAreaId]="constructorInfoAreaId"
  [optionGuideNoticeKey]="''"
  [(optionActionGuideNoticeDisplay)]="viewGuideNotice"
  [optionTreeDisplay]="false"
  [optionActionRowId]="tableRowSelected?.id"
  [optionActionRowDisplay]="tableRowSelected?.appInfo?.length > 0"
  [optionActionRowDisplayMenu]="false"
  [optionSelectRowItemTitle]="tableRowSelected?.appInfo"
>
  <ng-container cms-tree></ng-container>
  <ng-container cms-header>
    <h1>{{ "ROUTE.CORELOG.MICROSERVICESTATUS" | translate }}</h1>
  </ng-container>
  <ng-container cms-action-header></ng-container>
  <ng-container cms-action-header-start>
    <a
      type="button"
      class="btn font-13 font-600 btn-s m-1 rounded-s shadow-xl border-0 gradient-highlight"
      (click)="viewGuideNotice = !viewGuideNotice"
      target="_blank"
      ><i class="fa-solid fa-info font-18" style="color: #ffffff"></i
    ></a>
    <button
      type="button"
      class="btn font-13 font-600 btn-s m-1 rounded-s shadow-xl border-0 gradient-highlight"
      (click)="onActionButtonReload()"
      [disabled]="statusLoading"
    >
      <i
        class="fa-solid fa-rotate-right font-18"
        style="color: #ffffff"
        [class.rotation360]="statusLoading"
      ></i>
    </button>
    <div class="filter-group">
      <input
        type="text"
        [(ngModel)]="appInfoFilter"
        [placeholder]="'ROUTE.CORELOG.MICROSERVICEMONITOR_FILTER' | translate"
        class="filter-input"
      />
      <button type="button" class="btn btn-primary" (click)="onApplyFilter()">
        {{ "ROUTE.CORELOG.MICROSERVICEMONITOR_APPLY" | translate }}
      </button>
    </div>
    <button
      type="button"
      class="btn btn-icon"
      (click)="toggleTheme()"
      [attr.aria-label]="
        isDarkMode
          ? ('ROUTE.CORELOG.MICROSERVICEMONITOR_THEME_LIGHT' | translate)
          : ('ROUTE.CORELOG.MICROSERVICEMONITOR_THEME_DARK' | translate)
      "
    >
      {{ isDarkMode ? "‚òÄÔ∏è" : "üåô" }}
    </button>
  </ng-container>
  <ng-container cms-action-header-end></ng-container>
  <ng-container cms-action-main></ng-container>
  <ng-container cms-action-row></ng-container>
  <ng-container cms-action-area></ng-container>
  <ng-container cms-body>
    <div class="micro-service-status-content" [class.dark-theme]="isDarkMode">
      <div *ngIf="errorMessage" class="alert alert-error">
        {{ errorMessage }}
      </div>

      <div class="monitor-content monitor-content-mobile">
        <section class="status-list-section">
          <h2>{{ "ROUTE.CORELOG.MICROSERVICEMONITOR_LIST" | translate }}</h2>
          <div *ngIf="statusLoading" class="status-loading">
            {{ "ROUTE.CORELOG.MICROSERVICEMONITOR_LOADING" | translate }}
          </div>
          <div *ngIf="!statusLoading" class="status-cards">
            <div
              *ngFor="let item of statusList; trackBy: trackById"
              class="status-card"
              [class.selected]="tableRowSelected?.id === item?.id"
              [class.online]="isOnline(item)"
              [class.offline]="!isOnline(item)"
              (click)="onActionTableRowSelect(item)"
            >
              <div class="status-badge">
                <span class="dot" [class.online]="isOnline(item)"></span>
                {{
                  isOnline(item)
                    ? ("ROUTE.CORELOG.MICROSERVICEMONITOR_ONLINE" | translate)
                    : ("ROUTE.CORELOG.MICROSERVICEMONITOR_OFFLINE" | translate)
                }}
              </div>
              <div class="status-info">
                <strong>{{ item?.appInfo || "-" }}</strong>
                <span class="version">v{{ item?.appVersion || "-" }}</span>
                <span class="last-update">{{ getLastUpdate(item) }}</span>
              </div>
            </div>
            <p *ngIf="!statusList?.length" class="empty-message">
              {{ "ROUTE.CORELOG.MICROSERVICEMONITOR_EMPTY" | translate }}
            </p>
          </div>
        </section>

        <section *ngIf="tableRowSelected as item" class="detail-section">
          <h2>
            {{ "ROUTE.CORELOG.MICROSERVICEMONITOR_DETAIL" | translate }}:
            {{ item?.appInfo || "-" }}
          </h2>
          <div class="detail-card">
            <div class="detail-row">
              <span class="label"
                >{{
                  "ROUTE.CORELOG.MICROSERVICEMONITOR_VERSION" | translate
                }}:</span
              >
              <span>{{ item?.appVersion || "-" }}</span>
            </div>
            <div class="detail-row">
              <span class="label"
                >{{
                  "ROUTE.CORELOG.MICROSERVICEMONITOR_PATH" | translate
                }}:</span
              >
              <span>{{ item?.appLocation || "-" }}</span>
            </div>
            <div class="detail-row">
              <span class="label"
                >{{
                  "ROUTE.CORELOG.MICROSERVICEMONITOR_START" | translate
                }}:</span
              >
              <span>{{ getAppInfoStart(item) }}</span>
            </div>
            <div class="detail-row">
              <span class="label"
                >{{
                  "ROUTE.CORELOG.MICROSERVICEMONITOR_LASTUPDATE" | translate
                }}:</span
              >
              <span>{{ getLastUpdate(item) }}</span>
            </div>
            <div
              *ngIf="item?.operationStatisticsJson"
              class="detail-row full-width"
            >
              <span class="label"
                >{{
                  "ROUTE.CORELOG.MICROSERVICEMONITOR_STATS" | translate
                }}:</span
              >
              <pre class="json-preview">{{
                item?.operationStatisticsJson
              }}</pre>
            </div>
            <div
              *ngIf="item?.smsProviderStatusJson"
              class="detail-row full-width"
            >
              <span class="label"
                >{{
                  "ROUTE.CORELOG.MICROSERVICEMONITOR_SMSSTATUS" | translate
                }}:</span
              >
              <pre class="json-preview">{{ item?.smsProviderStatusJson }}</pre>
            </div>
          </div>

          <div class="action-group">
            <h3>Ping</h3>
            <button
              type="button"
              class="btn btn-primary"
              (click)="onPing()"
              [disabled]="pingLoading"
            >
              {{
                pingLoading
                  ? ("ROUTE.CORELOG.MICROSERVICEMONITOR_PINGING" | translate)
                  : "Ping"
              }}
            </button>
            <div *ngIf="pingResult as ping" class="ping-result">
              <span>RTT: {{ ping.rttMs ?? "-" }} ms</span>
            </div>
          </div>

          <div class="action-group">
            <h3>
              {{ "ROUTE.CORELOG.MICROSERVICEMONITOR_COMMANDS" | translate }}
            </h3>
            <div class="command-buttons">
              <button
                type="button"
                class="btn btn-outline"
                (click)="onSendCommand(MicroServiceCommandTypeEnum.PauseStatus)"
                [disabled]="commandLoading"
              >
                {{ getCommandLabel(MicroServiceCommandTypeEnum.PauseStatus) }}
              </button>
              <button
                type="button"
                class="btn btn-outline"
                (click)="
                  onSendCommand(MicroServiceCommandTypeEnum.ResumeStatus)
                "
                [disabled]="commandLoading"
              >
                {{ getCommandLabel(MicroServiceCommandTypeEnum.ResumeStatus) }}
              </button>
              <button
                type="button"
                class="btn btn-outline"
                (click)="
                  onSendCommand(MicroServiceCommandTypeEnum.ReloadConfig)
                "
                [disabled]="commandLoading"
              >
                {{ getCommandLabel(MicroServiceCommandTypeEnum.ReloadConfig) }}
              </button>
              <button
                type="button"
                class="btn btn-outline"
                (click)="
                  onSendCommand(MicroServiceCommandTypeEnum.UpdateSettings)
                "
                [disabled]="commandLoading"
              >
                {{
                  getCommandLabel(MicroServiceCommandTypeEnum.UpdateSettings)
                }}
              </button>
            </div>
          </div>
        </section>
      </div>
    </div>
  </ng-container>
  <ng-container cms-footer></ng-container>
</app-cms-html-list-mobile>
