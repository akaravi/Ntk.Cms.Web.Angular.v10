<app-cms-html-list-mobile
  [optionsListInfoAreaId]="constructorInfoAreaId"
  [optionGuideNoticeKey]="'core-log.micro-service-status.list'"
  [(optionActionGuideNoticeDisplay)]="viewGuideNotice"
  [optionTreeDisplay]="false"
  [optionActionRowId]="tableRowSelected?.id"
  [optionActionRowDisplay]="tableRowSelected?.appInfo?.length > 0"
  [optionActionRowDisplayMenu]="tableRowSelect2Click"
  [optionSelectRowItemTitle]="tableRowSelected?.appInfo"
>
  <ng-container cms-tree></ng-container>
  <ng-container cms-header></ng-container>
  <ng-container cms-action-header></ng-container>
  <ng-container cms-action-header-start>
    <a
      type="button"
      class="btn font-13 font-600 btn-s m-1 rounded-s shadow-xl border-0 gradient-highlight"
      (click)="viewGuideNotice = !viewGuideNotice"
      target="_blank"
      ><i class="fa-solid fa-info font-18" style="color: #ffffff"></i
    ></a>
    <button
      type="button"
      class="btn font-13 font-600 btn-s m-1 rounded-s shadow-xl border-0 gradient-highlight"
      (click)="onActionButtonReload()"
      [disabled]="statusLoading"
    >
      <i
        class="fa-solid fa-rotate-right font-18"
        style="color: #ffffff"
        [class.rotation360]="statusLoading"
      ></i>
    </button>
    <a
      (click)="onActionGridExpandRows(true)"
      target="_blank"
      class="btn font-13 font-600 btn-s m-1 rounded-s shadow-xl border-0 gradient-highlight"
    >
      <i class="fa-solid fa-maximize font-18" style="color: #ffffff"></i>
    </a>
    <a
      (click)="onActionGridExpandRows(false)"
      target="_blank"
      class="btn font-13 font-600 btn-s m-1 rounded-s shadow-xl border-0 gradient-highlight"
    >
      <i class="fa-solid fa-minimize font-18" style="color: #ffffff"></i>
    </a>
    <div class="filter-group">
      <input
        type="text"
        [(ngModel)]="appInfoFilter"
        [placeholder]="'ROUTE.CORELOG.MICROSERVICEMONITOR_FILTER' | translate"
        class="filter-input"
      />
      <button type="button" class="btn btn-primary" (click)="onApplyFilter()">
        {{ "ROUTE.CORELOG.MICROSERVICEMONITOR_APPLY" | translate }}
      </button>
    </div>
  </ng-container>
  <ng-container cms-action-header-end></ng-container>
  <ng-container cms-action-main></ng-container>
  <ng-container cms-action-row>
    @if (tableRowSelected) {
      <div class="col-4">
        <button
          type="button"
          class="btn font-13 font-600 btn-s m-1 rounded-s shadow-xl border-0 gradient-highlight"
          (click)="onActionButtonViewRow(tableRowSelected)"
        >
          <i class="fa-solid fa-eye font-18" style="color: #ffffff"></i><br />
        </button>
        <p class="font-11 text-center opacity-70">
          {{ "ACTION.VIEW" | translate }}
        </p>
      </div>
      <div class="col-4">
        <button
          type="button"
          class="btn font-13 font-600 btn-s m-1 rounded-s shadow-xl border-0 gradient-highlight"
          (click)="onPing()"
          [disabled]="pingLoading"
        >
          <i class="fa-solid fa-signal font-18" style="color: #ffffff"></i
          ><br />
        </button>
        <p class="font-11 text-center opacity-70">
          {{
            pingLoading
              ? ("ROUTE.CORELOG.MICROSERVICEMONITOR_PINGING" | translate)
              : "Ping"
          }}
        </p>
      </div>
      <div class="col-4">
        <button
          type="button"
          class="btn font-13 font-600 btn-s m-1 rounded-s shadow-xl border-0 gradient-magenta"
          (click)="onSendCommand(MicroServiceCommandTypeEnum.PauseStatus)"
          [disabled]="commandLoading"
        >
          <i class="fa-solid fa-pause font-18" style="color: #ffffff"></i><br />
        </button>
        <p class="font-11 text-center opacity-70">
          {{ getCommandLabel(MicroServiceCommandTypeEnum.PauseStatus) }}
        </p>
      </div>
      <div class="col-4">
        <button
          type="button"
          class="btn font-13 font-600 btn-s m-1 rounded-s shadow-xl border-0 gradient-blue"
          (click)="onSendCommand(MicroServiceCommandTypeEnum.ResumeStatus)"
          [disabled]="commandLoading"
        >
          <i class="fa-solid fa-play font-18" style="color: #ffffff"></i><br />
        </button>
        <p class="font-11 text-center opacity-70">
          {{ getCommandLabel(MicroServiceCommandTypeEnum.ResumeStatus) }}
        </p>
      </div>
      <div class="col-4">
        <button
          type="button"
          class="btn font-13 font-600 btn-s m-1 rounded-s shadow-xl border-0 gradient-green"
          (click)="onSendCommand(MicroServiceCommandTypeEnum.ReloadConfig)"
          [disabled]="commandLoading"
        >
          <i class="fa-solid fa-rotate font-18" style="color: #ffffff"></i
          ><br />
        </button>
        <p class="font-11 text-center opacity-70">
          {{ getCommandLabel(MicroServiceCommandTypeEnum.ReloadConfig) }}
        </p>
      </div>
      <div class="col-4">
        <button
          type="button"
          class="btn font-13 font-600 btn-s m-1 rounded-s shadow-xl border-0 gradient-yellow"
          (click)="onSendCommand(MicroServiceCommandTypeEnum.UpdateSettings)"
          [disabled]="commandLoading"
        >
          <i class="fa-solid fa-gear font-18" style="color: #ffffff"></i><br />
        </button>
        <p class="font-11 text-center opacity-70">
          {{ getCommandLabel(MicroServiceCommandTypeEnum.UpdateSettings) }}
        </p>
      </div>
      @if (pingResult) {
        <div class="col-12">
          <div class="ping-result">
            <strong>RTT: {{ pingResult.rttMs ?? "-" }} ms</strong>
          </div>
        </div>
      }
    }
  </ng-container>
  <ng-container cms-action-area></ng-container>
  <ng-container cms-body>
    @if (errorMessage) {
      <div class="alert alert-error">{{ errorMessage }}</div>
    }
    @if (statusList?.length) {
      <div class="cms-m-list">
        @for (row of statusList; track trackById($index, row)) {
          <div
            class="cms-m-list-item border-highlight"
            [class.selected]="row.id === tableRowSelected?.id"
            [class.bg-fade-highlight-light]="row.id === tableRowSelected?.id"
            (click)="onActionTableRowSelect(row, $event)"
            (rtclick)="onActionTableRowSelect(row, $event)"
            role="button"
            [attr.aria-label]="row?.appInfo"
            tabindex="0"
          >
            <div class="cms-m-list-item-image-placeholder">
              <i [ngClass]="row.recordStatus | statusIconClass" aria-hidden="true"></i>
            </div>
            <div class="cms-m-list-item-content">
              <div class="cms-m-list-item-title">{{ row?.appInfo || "-" }}</div>
              <div class="cms-m-list-item-subtitle">
                <span class="status-badge">
                  <span class="dot" [class.online]="isOnline(row)"></span>
                  {{
                    isOnline(row)
                      ? ("ROUTE.CORELOG.MICROSERVICEMONITOR_ONLINE" | translate)
                      : ("ROUTE.CORELOG.MICROSERVICEMONITOR_OFFLINE"
                        | translate)
                  }}
                </span>
              </div>
              @if (row?.appVersion) {
                <div class="cms-m-list-item-subtitle">
                  <i class="fa-solid fa-code-branch" aria-hidden="true"></i>
                  v{{ row.appVersion }}
                </div>
              }
              @if (getLastUpdate(row)) {
                <div class="cms-m-list-item-subtitle">
                  <i class="fa-solid fa-calendar" aria-hidden="true"></i>
                  {{ getLastUpdate(row) }}
                </div>
              }
              <!-- Expanded Detail (when row is expanded) -->
              @if (row.id === tableRowSelected?.id) {
                <div class="cms-m-list-item-expanded">
                  @if (row?.id) {
                    <div class="cms-m-list-item-subtitle">
                      <span
                        class="navi-icon pointer"
                        [cdkCopyToClipboard]="row.id?.toString() || ''"
                        (click)="$event.stopPropagation()"
                      >
                        <i class="flaticon2-copy"></i>
                      </span>
                      ID: {{ row.id }}
                    </div>
                  }
                  @if (row?.instanceIdentifier) {
                    <div class="cms-m-list-item-subtitle">
                      <i class="fa-solid fa-fingerprint" aria-hidden="true"></i>
                      Instance: {{ row.instanceIdentifier }}
                    </div>
                  }
                  @if (row?.runtimeIdentity) {
                    <div class="cms-m-list-item-subtitle">
                      <i class="fa-solid fa-id-card" aria-hidden="true"></i>
                      Runtime: {{ row.runtimeIdentity }}
                    </div>
                  }
                </div>
              }
            </div>
          </div>
        }
      </div>
    } @else {
      <div class="cms-m-empty">
        {{ "ROUTE.CORELOG.MICROSERVICEMONITOR_EMPTY" | translate }}
      </div>
    }
  </ng-container>
  <ng-container cms-footer></ng-container>
</app-cms-html-list-mobile>
